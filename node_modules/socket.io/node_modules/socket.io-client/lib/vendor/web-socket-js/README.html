<h2 id="how-to-try-the-sample">How to try the sample</h2>
<p>Assuming you have Web server (e.g. Apache) running at <strong><a href="http://example.com/">http://example.com/</a></strong> .</p>
<ol>
<li>Download <a href="http://github.com/gimite/web-socket-ruby/tree/master">web-socket-ruby</a>.</li>
<li>Run sample Web Socket server (echo server) in example.com with: (#1)<br><pre><code>$ ruby web-socket-ruby/samples/echo_server.rb example.com 10081</code></pre>
</li>
<li>If your server already provides socket policy file at port <strong>843</strong>, modify the file to allow access to port <strong>10081</strong>. Otherwise you can skip this step. See below for details.</li>
<li>Publish the web-socket-js directory with your Web server (e.g. put it in ~/public_html).</li>
<li>Change ws://localhost:10081 to <strong>ws://example.com:10081</strong> in sample.html.</li>
<li>Open sample.html in your browser.</li>
<li>After &quot;onopen&quot; is shown, input something, click [Send] and confirm echo back.</li>
</ol>
<p>#1: First argument of echo_server.rb means that it accepts Web Socket connection from HTML pages in example.com.</p>
<h2 id="how-to-use-it-in-your-application">How to use it in your application</h2>
<ul>
<li>Copy swfobject.js, web_socket.js, WebSocketMain.swf to your application directory.</li>
<li>Write JavaScript code:</li>
</ul>
<pre><code class="lang-html">&lt;!-- Import JavaScript Libraries. --&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;swfobject.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;web_socket.js&quot;&gt;&lt;/script&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

  // Let the library know where WebSocketMain.swf is:
  WEB_SOCKET_SWF_LOCATION = &quot;WebSocketMain.swf&quot;;

  // Write your code in the same way as for native WebSocket:
  var ws = new WebSocket(&quot;ws://example.com:10081/&quot;);
  ws.onopen = function() {
    ws.send(&quot;Hello&quot;);  // Sends a message.
  };
  ws.onmessage = function(e) {
    // Receives a message.
    alert(e.data);
  };
  ws.onclose = function() {
    alert(&quot;closed&quot;);
  };

&lt;/script&gt;</code></pre>
<ul>
<li>Put Flash socket policy file to your server unless you use web-socket-ruby or em-websocket as your WebSocket server. See &quot;Flash socket policy file&quot; section below for details.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If it doesn&#39;t work, try these:</p>
<ol>
<li><p>Try Chrome and Firefox 3.x.</p>
<ul>
<li>It doesn&#39;t work on Chrome:<br>
It&#39;s likely an issue of your code or the server. Debug your code as usual e.g. using console.log.</li>
<li>It works on Chrome but it doesn&#39;t work on Firefox:<br>
It&#39;s likely an issue of web-socket-js specific configuration (e.g. 3 and 4 below).</li>
<li>It works on both Chrome and Firefox, but it doesn&#39;t work on your browser:<br>
Check &quot;Supported environment&quot; section below. Your browser may not be supported by web-socket-js.</li>
</ul>
</li>
<li><p>Add this line before your code:</p>
<pre><code>WEB_SOCKET_DEBUG = true;</code></pre>
<p>and use Developer Tools (Chrome/Safari) or Firebug (Firefox) to see if console.log outputs any errors.</p>
</li>
<li><p>Make sure you do NOT open your HTML page as local file e.g. file:///.../sample.html. web-socket-js doesn&#39;t work on local file. Open it via Web server e.g. <a href="http:///.../sample.html">http:///.../sample.html</a>.</p>
</li>
<li><p>If you are NOT using web-socket-ruby or em-websocket as your WebSocket server, you need to place Flash socket policy file on your server. See &quot;Flash socket policy file&quot; section below for details.</p>
</li>
<li><p>Check if sample.html bundled with web-socket-js works.</p>
</li>
<li><p>Make sure the port used for WebSocket (10081 in example above) is not blocked by your server/client&#39;s firewall.</p>
</li>
<li><p>Install <a href="http://www.adobe.com/support/flashplayer/downloads.html">debugger version of Flash Player</a> to see Flash errors.</p>
</li>
</ol>
<h2 id="supported-environments">Supported environments</h2>
<p>It should work on:</p>
<ul>
<li>Google Chrome 4 or later (just uses native implementation)</li>
<li>Firefox 3.x, 4.x, Internet Explorer 8, 9 + Flash Player 10 or later</li>
</ul>
<p>It may or may not work on other browsers such as Safari, Opera or IE 6. Patch for these browsers are appreciated, but I will not work on fixing issues specific to these browsers by myself.</p>
<h2 id="limitations-differences-compared-to-native-websocket">Limitations/differences compared to native WebSocket</h2>
<ul>
<li>You need some more lines in your JavaScript code. See &quot;How to use it in your application&quot; section above for details.</li>
<li>It requires Flash Player 10 or later unless the browser supports native WebSocket.</li>
<li>Your server must provide Flash socket policy file, unless you use web-socket-ruby or em-websocket. See &quot;Flash socket policy file&quot; section below for details.</li>
<li>It has limited support for Cookies on WebSocket. See &quot;Cookie support&quot; section below for details.</li>
<li>It doesn&#39;t use proxies specified in browser config. See &quot;Proxy support&quot; section below for details.</li>
</ul>
<h3 id="flash-socket-policy-file">Flash socket policy file</h3>
<p>This implementation uses Flash&#39;s socket, which means that your server must provide Flash socket policy file to declare the server accepts connections from Flash.</p>
<p>If you use <a href="http://github.com/gimite/web-socket-ruby/tree/master">web-socket-ruby</a> or <a href="https://github.com/igrigorik/em-websocket">em-websocket</a>, you don&#39;t need anything special, because they handle Flash socket policy file request. But if you already provide socket policy file at port <strong>843</strong>, you need to modify the file to allow access to Web Socket port, because it precedes what the libraries provide.</p>
<p>If you use other Web Socket server implementation, you need to provide socket policy file yourself. See <a href="http://www.lightsphere.com/dev/articles/flash_socket_policy.html">Setting up A Flash Socket Policy File</a> for details and sample script to run socket policy file server. <a href="http://github.com/LearnBoost/Socket.IO-node/blob/master/lib/socket.io/transports/flashsocket.js">node.js implementation is available here</a>.</p>
<p>Actually, it&#39;s still better to provide socket policy file at port 843 even if you use web-socket-ruby or em-websocket. Flash always try to connect to port 843 first, so providing the file at port 843 makes startup faster.</p>
<h3 id="cookie-support">Cookie support</h3>
<p>web-socket-js has limited supported for Cookies on WebSocket.</p>
<p>Cookie is sent if Web Socket host is exactly the same as the origin of JavaScript (The port can be different). Otherwise it is not sent, because I don&#39;t know way to send right Cookie (which is Cookie of the host of Web Socket, I heard). Also, HttpOnly Cookies are not sent.</p>
<p>Note that it&#39;s technically possible that client sends arbitrary string as Cookie and any other headers (by modifying this library for example) once you place Flash socket policy file in your server. So don&#39;t trust Cookie and other headers if you allow connection from untrusted origin.</p>
<h3 id="proxy-support">Proxy support</h3>
<p><a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">The WebSocket spec</a> specifies instructions for User Agents to support proxied connections by implementing the HTTP CONNECT method.</p>
<p>The AS3 Socket class doesn&#39;t implement this mechanism, which renders it useless for the scenarios where the user trying to open a socket is behind a proxy. </p>
<p>The class RFC2817Socket (by Christian Cantrell) effectively lets us implement this, as long as the proxy settings are known and provided by the interface that instantiates the WebSocket. As such, if you want to support proxied conncetions, you&#39;ll have to supply this information to the WebSocket constructor when Flash is being used. One way to go about it would be to ask the user for proxy settings information if the initial connection fails.</p>
<h2 id="how-to-host-html-file-and-swf-file-in-different-domains">How to host HTML file and SWF file in different domains</h2>
<p>By default, HTML file and SWF file must be in the same domain. You can follow steps below to allow hosting them in different domain.</p>
<p><strong>WARNING</strong>: If you use the method below, HTML files in ANY domains can send arbitrary TCP data to your WebSocket server, regardless of configuration in Flash socket policy file. Arbitrary TCP data means that they can even fake request headers including Origin and Cookie.</p>
<ol>
<li>Unzip WebSocketMainInsecure.zip to extract WebSocketMainInsecure.swf.</li>
<li>Put WebSocketMainInsecure.swf on your server, instead of WebSocketMain.swf.</li>
<li>In JavaScript, set WEB_SOCKET_SWF_LOCATION to URL of your WebSocketMainInsecure.swf.</li>
</ol>
<h2 id="how-to-build-websocketmain-swf">How to build WebSocketMain.swf</h2>
<p>Install <a href="http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+4">Flex 4 SDK</a>.</p>
<pre><code>$ cd flash-src
$ ./build.sh</code></pre>
<h2 id="websocket-protocol-versions">WebSocket protocol versions</h2>
<ul>
<li>web-socket-js supports <a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76">Hixie 76 version</a> of WebSocket protocol by default i.e. in <a href="https://github.com/gimite/web-socket-js">master branch</a>.</li>
<li>If you want to try newer <a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-07">Hybi 07 version</a>, check out from <a href="https://github.com/gimite/web-socket-js/tree/hybi-07">hybi-07 branch</a>. This will become the master branch in the future, probably when Chrome switches to Hybi 07.</li>
<li>Hixie 75 or before is no longer supported.</li>
</ul>
<h2 id="license">License</h2>
<p>New BSD License.</p>
